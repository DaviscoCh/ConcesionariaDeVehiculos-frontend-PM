<div class="historial-section">
    <div class="container-fluid">
        <!-- Encabezado -->
        <div class="historial-header text-center mb-4 mt-2">
            <div class="header-icon">
                <i class="bi bi-calendar-check"></i>
            </div>
            <h2 class="section-title">ğŸ“… Historial de Citas</h2>
            <p class="section-subtitle">Revisa el estado de todas tus citas agendadas</p>
        </div>

        <!-- Lista de citas -->
        <div *ngIf="citas.length > 0; else sinCitas">
            <div class="row g-4">
                <div *ngFor="let c of citas" class="col-12 col-md-6 col-lg-4">
                    <div class="card compra-item h-100">
                        <!-- Badge de estado en la esquina -->
                        <div class="estado-badge">
                            <span [ngClass]="{
                                'badge-warning': c.estado === 'Pendiente',
                                'badge-success': c.estado === 'Confirmada',
                                'badge-primary': c.estado === 'Atendida',
                                'badge-danger': c.estado === 'Cancelada'
                            }">{{ c.estado }}</span>
                        </div>

                        <div class="card-body">
                            <!-- VehÃ­culo -->
                            <div class="cita-info mb-3">
                                <h6 class="info-label">ğŸš— VehÃ­culo</h6>
                                <p class="info-value">{{ c.marca }} {{ c.modelo }} ({{ c.anio }})</p>
                            </div>

                            <!-- Oficina -->
                            <div class="cita-info mb-3">
                                <h6 class="info-label">ğŸ¢ Oficina</h6>
                                <p class="info-value">{{ c.nombre_oficina }}</p>
                            </div>

                            <!-- Fecha y Hora -->
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="cita-info">
                                        <h6 class="info-label">ğŸ“… Fecha</h6>
                                        <p class="info-value">{{ c.fecha | date:'dd/MM/yyyy' }}</p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="cita-info">
                                        <h6 class="info-label">ğŸ• Hora</h6>
                                        <p class="info-value">{{ c.hora?.substring(0, 5) }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Comentario -->
                            <div class="cita-info mb-3" *ngIf="c.comentario">
                                <h6 class="info-label">ğŸ’¬ Comentario</h6>
                                <p class="info-value text-muted">{{ c.comentario }}</p>
                            </div>

                            <!-- Mensaje de cita cumplida -->
                            <div *ngIf="c.estado === 'Atendida'" class="alert-cumplida mb-3">
                                <i class="bi bi-check-circle-fill me-2"></i>
                                <strong>Cita cumplida</strong>
                            </div>

                            <!-- BotÃ³n ver factura -->
                            <button *ngIf="c.estado === 'Atendida'" class="btn btn-primary w-100"
                                (click)="verFactura(c.id_cita)">
                                <i class="bi bi-receipt me-2"></i>Ver Factura
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sin citas -->
        <ng-template #sinCitas>
            <div class="empty-state">
                <div class="empty-icon-bg">
                    <i class="bi bi-calendar-x"></i>
                </div>
                <h3>No tienes citas registradas</h3>
                <p>Agenda tu primera cita para ver tu historial aquÃ­</p>
                <a routerLink="/reservar-cita" class="btn btn-primary mt-3">
                    <i class="bi bi-calendar-plus me-2"></i>Agendar Cita
                </a>
            </div>
        </ng-template>

        <!-- Error -->
        <div *ngIf="error" class="alert alert-danger text-center mt-4">
            <i class="bi bi-exclamation-circle me-2"></i>{{ error }}
        </div>
    </div>
</div>